<body style="padding:0px;margin:0px" id="body">



<button type="button" onclick="start()"> PRESS TO START</button>


<canvas width=650 height= 900 id="canvas" style="border:5px solid red; margin:0px; display: none">

</canvas>


<script>
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");
    var mC = new mainCharacter();
    var modeDetector = 0;
  //  var health = new health(0);
  //  var health2 = new health(0);
    var bullets = [];
    var enemies = [];
    var health = [];
    health.push(new Health(0));
    health.push(new Health(30));
    health.push(new Health(60));
    enemies.push(new Enemy(100 , 0, 2));
    enemies.push(new Enemy(300 , 0, 1));
    enemies.push(new Enemy(500 , 0, 0));

    document.addEventListener("keydown", processKeyDown);
    document.addEventListener("keyup", processKeyUp);
    var startSong = new Audio("stageIntro.mp3");
    var shootSound = new Audio("fire.mp3");



    function start() {
      if(modeDetector == 0) {
        startSong.play();
        test = setTimeout(progress, 10);//6600);
      }
    }
    function progress(){
      modeDetector = modeDetector+1;
    }
    function regress(){
      modeDetector = modeDetector-1;
    }


    setInterval(doIt , 33);

    function doIt() {
      canvas.style.display = "block";
      if(modeDetector == 0) {
        doNothing();
      }
      else if (modeDetector == 1){
        doSingleStuff();
      }
      else if (modeDetector == 2){
        gameOver();
      }
    }

    function clearBackground(){
      context.fillStyle = "black";
      context.fillRect(0,0, canvas.width, canvas.height);
    }

    function doNothing(){
      clearBackground();
    }

    function doSingleStuff() {
      //console.log("beat");
      clearBackground();
      //console.log("main loop");
      mC.move();
      mC.drawShip();
      for(var pos = 0; pos < health.length; pos++){
              health[pos].draw();
      }

      //loop over the array

      for(var pos = 0; pos < bullets.length; pos++) {
        bullets[pos].move();
        if(bullets[pos].y < 0) {
          bullets.splice(pos, 1);
          pos--;
          console.log("bullet beyond");
        }

        else {
          var collided = false;
          for(var pos2 = 0; pos2 < enemies.length; pos2++) {
            if(detectCollision(bullets[pos], enemies[pos2])) {
              enemies.splice(pos2, 1);
              bullets.splice(pos, 1);
              pos--;
              pos2--;
              collided = true;
              console.log("bullet collide");
              break;
            }
          }
          if(collided == false) {
            bullets[pos].draw();
          }
        }
          if(mC.currentImagePos == 1){
             bullets[pos].height = 60;
           }
          else if(mC.currentImagePos == 2){
            bullets[pos].width = 10;
          }
    }

    for(var pos = 0; pos < enemies.length; pos++) {
      enemies[pos].move();
      if(enemies[pos].y+enemies[pos].height > canvas.height) {
        enemies.splice(pos, 1);
        pos--;
        console.log("gameOver");
      }

      else {
        var collided = false;
        for(var pos2 = 0; pos2 < bullets.length; pos2++) {
          if(detectCollision(bullets[pos2], enemies[pos])) {
            enemies.splice(pos, 1);
            bullets.splice(pos2, 1);
            pos--;
            pos2--;
            collided = true;
            console.log("enemy collide");
            break;
          }
        }
        if(collided == false) {
          enemies[pos].draw();
        }
      }
        // if(mC.currentImagePos == 1){
        //    bullets[pos].height = 60;
        //  }
        // else if(mC.currentImagePos == 2){
        //   bullets[pos].width = 10;
        // }
    }
  }

function prologueKeyDown(event){
  if(event.key == 'p'){

  }
}

function processKeyDown(event) {
  if(event.key == 'd') {
    if(mC.x + mC.spriteWidth >= canvas.width ) {
      mC.direction = 2;
    }
    else {
      mC.direction = 1;
    }
  }
  else if(event.key == 'a') {
    if(mC.x >= 0 ) {
      mC.direction = 2;
    }
    else {
      mC.direction = 1;
    }
  }
  if(event.key == 'f'){
    shootSound.play();
    bullets.push(new bullet(mC.x , mC.y));
  }
  if(event.key == 'q'){
    mC.currentImagePos++;
}
  if(mC.currentImagePos > 2){
    mC.currentImagePos = 0;
  }
}


//end of processKeyDown

//start of processKeyUp
function processKeyUp(event) {
  if(event.key == 'a' || 'd') {
    mC.direction = 0;
  }
}
    function mainCharacter() {
      this.speed = 10;
      this.direction = 0;
      this.x = 0;
      this.y = canvas.height - 100;
      this.sprite = new Image();
      this.sprite.src = "GalagaShip.png";
      this.totalImages = 3;
      this.currentImagePos = 0;
      this.subImageWidth = 190;
      this.subImageHeight = 190;


      this.drawShip = function() {
          context.drawImage(this.sprite, this.currentImagePos*this.subImageHeight, 0,
          this.subImageWidth, this.subImageHeight, this.x, this.y, this.subImageWidth/2,
          this.subImageHeight/2);
      }


      this.switchToLeft = function(){
        this.direction = 2;
      }
      this.switchToRight = function(){
        this.direction = 1;
      }
      // MOVE FUNCTION

      //1 is right
      //2 is left

      this.move = function() {
      //console.log(enemy1.health);
         if(this.direction == 1) {
          if(this.x >= canvas.width - 100){
            this.switchToLeft();
            this.x = this.x-10;
          }
          else {
            this.x += this.speed;
          }
        }
        else if(this.direction == 2) {
          if(this.x < 0 ) {
            this.switchToRight();
          }
          this.x -= this.speed;
        }
      }
    }//end of maincharacter




    function Enemy( x , y , p ) {
      this.health = 300;
      this.speed = 10;
      this.direction = 2;     //1 is right, 2 is left
      this.width = 50;
      this.height = 50;
      this.x = x;
      this.y = y;
      this.color = "red";
      this.pattern = p;
      this.currY = y;
      this.desire = 40;
      //dGDY = desired going down Y amount
      this.downSpeed = (this.speed)/3;

      this.draw = function() {
        context.fillStyle = this.color;
        context.fillRect(this.x, this.y, this.width, this.height);
      }
      //1 is right, 2 is left;
      this.switchToLeft = function(){
        this.direction = 2;
      }
      this.switchToRight = function(){
        this.direction = 1;
      }
      this.switchToDown = function() {
        this.direction = 3;
      }
      this.switchToUp = function() {
        this.direction = 4;
      }

      this.move = function() {
        if(this.pattern == 2) {
          if(this.direction == 2) {
            if(this.x <= 0) {
              this.direction = 3;
              this.currY = this.y;
            }
            else {
              this.x -= this.speed;
            }
          }
          else if(this.direction == 1) {
            if(this.x >= (canvas.width - this.width)) {
              this.direction = 3;
              this.currY = this.y;
            }
            else{
              this.x += this.speed;
            }
          }
           else if(this.direction == 3) {
            if(this.y >= canvas.height) {
              modeDetector = 2;
            }
            if(this.y >= (this.currY + this.desire)) {
              if(this.x == (canvas.width - this.width)) {
                this.direction = 2;
              }
              else {
                this.direction = 1;
              }
            }
            else {
              this.y += this.downSpeed;
            }
          }
          else {
            if(this.y >= canvas.height + (this.height)) {
              modeDetector = 2;
            }
            else {
              this.y += this.downSpeed;
            }
          }
        }


        else if(this.pattern == 1) {
          if(this.direction == 2) {
            if(this.x <= 0) {
              this.direction = 1;
              this.currY = this.y;
            }
            else{
              this.y += ((this.speed)/5);
              this.x -= this.speed;
            }
          }
          else if(this.direction == 1) {
            if(this.x >= canvas.width - (this.width)) {
              this.direction = 2;
              this.currY = this.y;
            }
            else {
              this.y += (this.speed)/5;
              this.x += this.speed;
            }
          }
        }


        else { // side-to-side and down the walls
          if(this.direction == 2) {
            if(this.x <= 0) {
              this.direction = 3;
              this.currY = this.y;
            }
            else {
              this.x -= this.speed;
            }
          }
          else if(this.direction == 1) {
            if(this.x >= (canvas.width - this.width)) {
              this.direction = 3;
              this.currY = this.y;
            }
            else{
              this.x += this.speed;
            }
          }
           else if(this.direction == 3) {
            if(this.y >= canvas.height) {
              modeDetector = 2;
            }
            if(this.y >= (this.currY + this.desire)) {
              if(this.x == (canvas.width - this.width)) {
                this.direction = 2;
              }
              else {
                this.direction = 1;
              }
            }
            else {
              this.y += this.downSpeed;
            }
          }
          else {
            if(this.y >= canvas.height + (this.height)) {
              modeDetector = 2;
            }
            else {
              this.y += this.downSpeed;
            }
          }
        }
      }
    }


    function Health(x){
      //this.state = state;
      this.sprite = new Image();
      this.sprite.src = "heart.png";
      this.totalImages = 2;
      this.currentImagePos = 0;
      this.subImageWidth = 35;
      this.subImageHeight = 30;
      this.width = 70;
      this.height = 30;
      this.x = x;
      this.y = canvas.height - 184;
      this.gainHealth = function(){
      }

      this.loseHealth = function(){

      }
      this.draw = function(){
        context.drawImage(this.sprite, this.x, this.y, this.width, this.height);      }
    }




    function bullet(x , y, ){
      //this.boolean = ifEnemy;
      this.x = x;
      this.y = y;
      this.width = 10;
      this.height = 30;
      this.speed = 20;
      this.sprite = new Image();
      this.sprite.src = "Bullet.png";
      this.move = function(){
        if(ifEnemy = true) {
          this.y -= this.speed;
        }
        else {
          this.y += this.speed;
        }
      }
    this.draw = function(){
      context.drawImage(this.sprite, this.x + 42, this.y - 10, this.width, this.height);
    }
  }


function gameOver() {
  this.draw = function() {
    context.clearBackground();
    // context.font = "20px Arial";
    // context.fillText("Game Over, friends!", 50, 50);
  }
}







  function detectCollision( obj1, obj2 ){
    return( obj1.x < obj2.x + obj2.width &&
    obj1.x + obj1.width > obj2.x &&
    obj1.y < obj2.y + obj2.height &&
    obj1.y + obj1.height > obj2.y);
  }
</script>
</body>
